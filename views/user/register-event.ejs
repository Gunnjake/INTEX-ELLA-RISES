<%- include('../partials/header', { title: 'Register for Event - Ella Rises', user: typeof user !== 'undefined' ? user : null }) %>

<!-- Register for Event page header -->
<div class="page-header">
    <h1>Register for Event</h1>
    <p>Select an upcoming event to register for</p>
</div>

<!-- Flash messages -->
<% if (typeof messages !== 'undefined' && messages.length > 0) { %>
    <% messages.forEach(function(message) { %>
        <div class="flash-message flash-<%= message.type %>" style="max-width: 1200px; margin: 1rem auto; padding: 0 2rem;">
            <%= message.text %>
        </div>
    <% }); %>
<% } %>

<div style="max-width: 1200px; margin: 2rem auto; padding: 0 2rem;">
    <% if (typeof events !== 'undefined' && events.length > 0) { %>
        <div class="table-container" role="region" aria-label="Events table">
            <table aria-label="Upcoming Events" style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th scope="col" style="padding: 12px; text-align: left; border-bottom: 2px solid var(--coral);">Event Name</th>
                        <th scope="col" style="padding: 12px; text-align: left; border-bottom: 2px solid var(--coral);">Date</th>
                        <th scope="col" style="padding: 12px; text-align: left; border-bottom: 2px solid var(--coral);">Location</th>
                        <th scope="col" style="padding: 12px; text-align: center; border-bottom: 2px solid var(--coral);">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% events.forEach(function(event) { %>
                        <% 
                            const eventId = event.eventoccurrenceid || event.EventOccurrenceID;
                            const eventName = event.eventname || event.EventName || 'Event';
                            const eventDate = event.eventdatetimestart || event.EventDateTimeStart;
                            const eventLocation = event.eventlocation || event.EventLocation || 'TBA';
                            
                            let formattedDate = 'Date TBA';
                            if (eventDate) {
                                try {
                                    const date = new Date(eventDate);
                                    formattedDate = date.toLocaleDateString('en-US', { 
                                        month: 'short', 
                                        day: 'numeric', 
                                        year: 'numeric',
                                        hour: 'numeric',
                                        minute: '2-digit'
                                    });
                                } catch (e) {
                                    formattedDate = 'Date TBA';
                                }
                            }
                        %>
                        <tr style="border-bottom: 1px solid var(--border-light);">
                            <td style="padding: 12px; font-weight: 500;"><%= eventName %></td>
                            <td style="padding: 12px;"><%= formattedDate %></td>
                            <td style="padding: 12px;"><%= eventLocation %></td>
                            <td style="padding: 12px; text-align: center;">
                                <form action="/events/register/<%= eventId %>" method="POST" style="display: inline;">
                                    <button type="submit" class="btn btn-primary" aria-label="Register for <%= eventName %>">Register</button>
                                </form>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    <% } else { %>
        <div class="form-card" style="text-align: center; padding: 3rem;">
            <p style="color: var(--text-secondary); font-size: 1.1rem; margin-bottom: 1rem;">
                No upcoming events available. Please check back later.
            </p>
            <a href="/events" class="btn btn-secondary">View All Events</a>
        </div>
    <% } %>
</div>

<style>
.page-header {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 0 2rem;
    text-align: center;
}

.page-header h1 {
    font-family: var(--font-header), serif;
    font-size: 2.5rem;
    color: var(--coral);
    margin-bottom: 0.5rem;
}

.page-header p {
    color: var(--text-secondary);
    font-size: 1.1rem;
}

.table-container {
    background: white;
    border-radius: 8px;
    box-shadow: var(--card-shadow);
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
}

table th {
    background: #f8f8f8;
    font-weight: 600;
    color: var(--text-dark);
}

table td {
    color: var(--text-dark);
}

table tr:hover {
    background: #f9f9f9;
}

.btn {
    padding: 0.5rem 1.5rem;
    border: none;
    border-radius: 4px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
}

.btn-primary {
    background: var(--coral);
    color: white;
}

.btn-primary:hover {
    background: var(--coral-dark, #d63e5a);
    transform: translateY(-1px);
}

.btn-secondary {
    background: var(--text-secondary);
    color: white;
}

.btn-secondary:hover {
    background: var(--text-dark);
}

.form-card {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: var(--card-shadow);
}

@media (max-width: 768px) {
    .page-header {
        padding: 0 1rem;
    }
    
    .page-header h1 {
        font-size: 2rem;
    }
    
    table {
        font-size: 0.9rem;
    }
    
    table th,
    table td {
        padding: 8px;
    }
    
    .btn {
        padding: 0.4rem 1rem;
        font-size: 0.85rem;
    }
}
</style>

<%- include('../partials/footer') %>



