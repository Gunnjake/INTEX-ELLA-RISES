<%- include('../partials/header', { title: 'Register for Event - Ella Rises', user: typeof user !== 'undefined' ? user : null }) %>

<!-- Event registration page header -->
<div class="page-header">
    <h1>REGISTER FOR EVENT</h1>
    <p>Select an upcoming event to register for</p>
</div>

<!-- Event registration form -->
<div class="form-container">
    <div class="form-card">
        <% if (typeof events !== 'undefined' && events.length > 0) { %>
            <form action="/events/register" method="POST" id="event-register-form" novalidate aria-label="Event Registration Form">
                <fieldset class="form-section">
                    <legend class="section-header">Select Event</legend>
                    <div class="form-group">
                        <label for="eventoccurrenceid">Choose an Event <span aria-label="required">*</span></label>
                        <select id="eventoccurrenceid" name="eventoccurrenceid" required aria-required="true">
                            <option value="">Select an event</option>
                            <% events.forEach(function(event) { %>
                                <% 
                                    const eventId = event.eventoccurrenceid || event.EventOccurrenceID;
                                    const eventName = event.eventname || event.EventName || 'Event';
                                    const eventDate = event.eventdatetimestart || event.EventDateTimeStart;
                                    const eventLocation = event.eventlocation || event.EventLocation || '';
                                    const eventType = event.eventtype || event.EventType || '';
                                    
                                    let displayText = eventName;
                                    if (eventDate) {
                                        try {
                                            const date = new Date(eventDate);
                                            const formattedDate = date.toLocaleDateString('en-US', { 
                                                month: 'short', 
                                                day: 'numeric', 
                                                year: 'numeric',
                                                hour: 'numeric',
                                                minute: '2-digit'
                                            });
                                            displayText += ` - ${formattedDate}`;
                                        } catch (e) {
                                            // If date parsing fails, just use the name
                                        }
                                    }
                                    if (eventLocation) {
                                        displayText += ` (${eventLocation})`;
                                    }
                                    if (eventType) {
                                        displayText += ` [${eventType}]`;
                                    }
                                %>
                                <option value="<%= eventId %>"><%= displayText %></option>
                            <% }); %>
                        </select>
                    </div>
                </fieldset>

                <!-- Submit Button -->
                <div class="form-section form-section-submit">
                    <button type="submit" class="btn btn-primary btn-submit" aria-label="Register for selected event">Register for Event</button>
                </div>
            </form>
        <% } else { %>
            <div class="form-section">
                <p style="text-align: center; color: var(--text-secondary); font-size: 1.1rem; padding: 2rem;">
                    No upcoming events available. Please check back later.
                </p>
                <div style="text-align: center; margin-top: 1rem;">
                    <a href="/events" class="btn btn-secondary">View All Events</a>
                </div>
            </div>
        <% } %>
    </div>
</div>

<script>
// Client-side validation
document.getElementById('event-register-form')?.addEventListener('submit', function(e) {
    const eventSelect = document.getElementById('eventoccurrenceid');
    
    if (!eventSelect || !eventSelect.value || isNaN(parseInt(eventSelect.value))) {
        e.preventDefault();
        alert('Please select a valid event.');
        return false;
    }
});
</script>

<style>
.form-container {
    max-width: 800px;
    margin: 2rem auto;
    padding: 0 2rem;
}

.form-card {
    background-color: var(--white);
    padding: 2.5rem;
    border-radius: 8px;
    box-shadow: var(--card-shadow);
}

.form-section {
    margin-bottom: 2.5rem;
    padding-bottom: 2rem;
    border-bottom: 2px solid var(--border-light);
}

.form-section:last-of-type {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.form-section-submit {
    margin-top: 2rem;
    padding-top: 2rem;
}

.section-header {
    font-family: var(--font-header), serif;
    font-size: 1.5rem;
    color: var(--coral);
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--coral);
    font-weight: 600;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    font-family: var(--font-body), Arial, Helvetica, sans-serif;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
}

.form-group select {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--border-light);
    border-radius: 4px;
    font-family: var(--font-body), Arial, Helvetica, sans-serif;
    font-size: 1rem;
    transition: border-color 0.3s ease;
    box-sizing: border-box;
}

.form-group select:focus {
    outline: none;
    border-color: var(--coral);
}

.btn-submit {
    width: 100%;
    padding: 1rem;
    font-size: 1.1rem;
}

@media (max-width: 768px) {
    .form-container {
        padding: 0 1rem;
    }
    
    .form-card {
        padding: 1.5rem;
    }
}
</style>

<%- include('../partials/footer') %>



