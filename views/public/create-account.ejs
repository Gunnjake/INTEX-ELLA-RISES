<%- include('../partials/header', { title: 'Create Account - Ella Rises', user: typeof user !== 'undefined' ? user : null }) %>

<!-- Account creation page header -->
<div class="page-header">
    <h1>CREATE ACCOUNT</h1>
    <p>Create your Ella Rises account to register for programs and events</p>
</div>

<!-- Account creation form -->
<div class="form-container">
    <div class="form-card">
        <form action="/create-account" method="POST" id="account-form" novalidate aria-label="Account Creation Form">
            <!-- Personal info section -->
            <fieldset class="form-section">
                <legend class="section-header">Personal Information</legend>
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label for="firstName">First Name <span aria-label="required">*</span></label>
                        <input type="text" id="firstName" name="firstName" required aria-required="true" autocomplete="given-name">
                    </div>
                    <div class="form-group form-group-half">
                        <label for="lastName">Last Name <span aria-label="required">*</span></label>
                        <input type="text" id="lastName" name="lastName" required aria-required="true" autocomplete="family-name">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label for="email">Email Address <span aria-label="required">*</span></label>
                        <input type="email" id="email" name="email" required aria-required="true" autocomplete="email">
                    </div>
                    <div class="form-group form-group-half">
                        <label for="phone">Phone Number <span aria-label="required">*</span></label>
                        <input type="tel" id="phone" name="phone" required aria-required="true" autocomplete="tel">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group form-group-third">
                        <label for="birthYear">Birth Year <span aria-label="required">*</span></label>
                        <input type="number" id="birthYear" name="birthYear" min="1900" max="<%= new Date().getFullYear() %>" required aria-required="true" placeholder="YYYY">
                    </div>
                    <div class="form-group form-group-third">
                        <label for="birthMonth">Birth Month <span aria-label="required">*</span></label>
                        <select id="birthMonth" name="birthMonth" required aria-required="true">
                            <option value="">Month</option>
                            <option value="01">January</option>
                            <option value="02">February</option>
                            <option value="03">March</option>
                            <option value="04">April</option>
                            <option value="05">May</option>
                            <option value="06">June</option>
                            <option value="07">July</option>
                            <option value="08">August</option>
                            <option value="09">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                    <div class="form-group form-group-third">
                        <label for="birthDay">Birth Day <span aria-label="required">*</span></label>
                        <input type="number" id="birthDay" name="birthDay" min="1" max="31" required aria-required="true" placeholder="DD">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label for="school_employer">School/Employer <span aria-label="required">*</span></label>
                        <input type="text" id="school_employer" name="school_employer" required aria-required="true" autocomplete="organization">
                    </div>
                    <div class="form-group form-group-half">
                        <label for="field_of_interest">Field of Interest <span aria-label="required">*</span></label>
                        <input type="text" id="field_of_interest" name="field_of_interest" required aria-required="true" placeholder="e.g., STEM, Arts, Education">
                    </div>
                </div>
            </fieldset>

            <!-- Location Information Section -->
            <fieldset class="form-section">
                <legend class="section-header">Location Information</legend>
                <div class="form-row location-row">
                    <div class="form-group form-group-half">
                        <label for="city">City <span aria-label="required">*</span></label>
                        <input type="text" id="city" name="city" required aria-required="true" autocomplete="address-level2">
                    </div>
                    <div class="form-group form-group-quarter">
                        <label for="state">State <span aria-label="required">*</span></label>
                        <select id="state" name="state" required aria-required="true" autocomplete="address-level1">
                            <option value="">Select State</option>
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                            <option value="DC">District of Columbia</option>
                        </select>
                    </div>
                    <div class="form-group form-group-quarter">
                        <label for="zip">Zip Code <span aria-label="required">*</span></label>
                        <input type="text" id="zip" name="zip" pattern="[0-9]{5}" required aria-required="true" autocomplete="postal-code" aria-describedby="zip-hint">
                        <small id="zip-hint" class="field-hint">5 digits</small>
                    </div>
                    <div class="form-group form-group-half">
                        <label for="country">Country <span aria-label="required">*</span></label>
                        <input type="text" id="country" name="country" value="USA" required aria-required="true" autocomplete="country-name">
                    </div>
                </div>
            </fieldset>

            <!-- Account Creation Section -->
            <fieldset class="form-section">
                <legend class="section-header">Account Security</legend>
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label for="password">Create Password <span aria-label="required">*</span></label>
                        <input type="password" id="password" name="password" required aria-required="true" aria-describedby="password-hint" autocomplete="new-password" maxlength="20" minlength="8">
                        <small id="password-hint" class="field-hint">Minimum 8 characters, maximum 20 characters</small>
                    </div>
                    <div class="form-group form-group-half">
                        <label for="confirmPassword">Confirm Password <span aria-label="required">*</span></label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required aria-required="true" aria-describedby="confirm-password-hint" autocomplete="new-password" maxlength="20" minlength="8">
                        <small id="confirm-password-hint" class="field-hint">Re-enter your password</small>
                    </div>
                </div>
                <div class="form-group">
                    <label for="newsletter">Newsletter Subscription</label>
                    <select id="newsletter" name="newsletter" required aria-required="true">
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>
            </fieldset>

            <!-- Submit Button -->
            <div class="form-section form-section-submit">
                <button type="submit" class="btn btn-primary btn-submit" aria-label="Create account">Create Account</button>
                <div style="text-align: center; margin-top: 1rem;">
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Already have an account? <a href="/login" style="color: var(--coral);">Login here</a></p>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
// Client-side validation
document.getElementById('account-form')?.addEventListener('submit', function(e) {
    // Validate password
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirmPassword');
    
    if (password && confirmPassword) {
        if (password.value.length < 8) {
            e.preventDefault();
            alert('Password must be at least 8 characters long.');
            password.focus();
            return false;
        }
        
        if (password.value.length > 20) {
            e.preventDefault();
            alert('Password must be 20 characters or less.');
            password.focus();
            return false;
        }
        
        if (password.value !== confirmPassword.value) {
            e.preventDefault();
            alert('Passwords do not match. Please try again.');
            confirmPassword.focus();
            return false;
        }
    }
    
    // Validate all required fields
    const firstName = document.getElementById('firstName');
    const lastName = document.getElementById('lastName');
    const email = document.getElementById('email');
    const phone = document.getElementById('phone');
    const birthYear = document.getElementById('birthYear');
    const birthMonth = document.getElementById('birthMonth');
    const birthDay = document.getElementById('birthDay');
    const schoolEmployer = document.getElementById('school_employer');
    const fieldOfInterest = document.getElementById('field_of_interest');
    const city = document.getElementById('city');
    const state = document.getElementById('state');
    const zip = document.getElementById('zip');
    const country = document.getElementById('country');
    
    if (!firstName?.value?.trim() || !lastName?.value?.trim() || !email?.value?.trim() || 
        !phone?.value?.trim() || !birthYear?.value || !birthMonth?.value || !birthDay?.value ||
        !schoolEmployer?.value?.trim() || !fieldOfInterest?.value?.trim() ||
        !city?.value?.trim() || !state?.value || !zip?.value?.trim() || !country?.value?.trim()) {
        e.preventDefault();
        alert('Please fill in all required fields (marked with *).');
        return false;
    }
    
    // Validate birthday
    const year = parseInt(birthYear.value);
    const month = parseInt(birthMonth.value);
    const day = parseInt(birthDay.value);
    
    if (isNaN(year) || isNaN(month) || isNaN(day)) {
        e.preventDefault();
        alert('Please enter a valid birthday.');
        return false;
    }
    
    // Validate date is valid
    const date = new Date(year, month - 1, day);
    if (date.getFullYear() !== year || date.getMonth() !== month - 1 || date.getDate() !== day) {
        e.preventDefault();
        alert('Please enter a valid date.');
        return false;
    }
});
</script>

<style>
.form-container {
    max-width: 1000px;
    margin: 2rem auto;
    padding: 0 2rem;
}

.form-card {
    background-color: var(--white);
    padding: 2.5rem;
    border-radius: 8px;
    box-shadow: var(--card-shadow);
}

.form-section {
    margin-bottom: 2.5rem;
    padding-bottom: 2rem;
    border-bottom: 2px solid var(--border-light);
}

.form-section:last-of-type {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.form-section-submit {
    margin-top: 2rem;
    padding-top: 2rem;
}

.section-header {
    font-family: var(--font-header), serif;
    font-size: 1.5rem;
    color: var(--coral);
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--coral);
    font-weight: 600;
}

.form-row {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin-bottom: 1rem;
}

.form-row:has(.form-group-third) {
    grid-template-columns: repeat(3, 1fr);
}

.form-row:last-child {
    margin-bottom: 0;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group:last-child {
    margin-bottom: 0;
}

.form-group-half {
    grid-column: span 1;
}

.form-group-quarter {
    grid-column: span 1;
}

.form-group-third {
    grid-column: span 1;
}

.form-group label {
    display: block;
    font-family: var(--font-body), Arial, Helvetica, sans-serif;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--border-light);
    border-radius: 4px;
    font-family: var(--font-body), Arial, Helvetica, sans-serif;
    font-size: 1rem;
    transition: border-color 0.3s ease;
    box-sizing: border-box;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--coral);
}

.btn-submit {
    width: 100%;
    padding: 1rem;
    font-size: 1.1rem;
}

.location-row {
    grid-template-columns: 2fr 1fr 1fr !important;
}

@media (max-width: 768px) {
    .form-container {
        padding: 0 1rem;
    }
    
    .form-card {
        padding: 1.5rem;
    }

    .form-row {
        grid-template-columns: 1fr;
        gap: 0;
    }

    .form-group-half,
    .form-group-quarter {
        grid-column: span 1;
    }

    .location-row {
        grid-template-columns: 1fr !important;
    }

    .form-section {
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
    }

    .section-header {
        font-size: 1.25rem;
    }
}
</style>

<%- include('../partials/footer') %>

